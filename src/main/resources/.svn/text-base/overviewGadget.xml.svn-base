<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="__MSG_gadget.titleOverview__"
                 directory_title="__MSG_gadget.titleOverview__"
                 description="__MSG_gadget.descriptionOverview__"
                 thumbnail="__ATLASSIAN_BASE_URL__/download/resources/jira-hudson.jira-hudson/thumbnails/overview.png"
                 >
        <Optional feature="gadget-directory">
            <Param name="categories">
                JIRA
            </Param>
        </Optional>
        <Require feature="setprefs"/>
        <Require feature="dynamic-height" />
    	<Optional feature="auth-refresh"/>
    	<Require feature="views" />
        <Locale messages="__ATLASSIAN_BASE_URL__/download/resources/jira-hudson.jira-hudson/i18n/ALL_ALL.xml"/>
    </ModulePrefs>
    <UserPref name="isConfigured" datatype="hidden" default_value="false"/>
    <UserPref name="hudsonUrl" display_name="Hudsonname oder Url" default_value="http://localhost:8080/" required="true"/>
    <UserPref name="view" default_value=""/>
    <UserPref name="userName" default_value=""/>
    <UserPref name="password" default_value=""/>
    <Content type="html" view="profile">
    	<![CDATA[
    	    <script type="text/javascript" charset="utf-8">
    	    
                function makeDOMRequest() {
				  var params = {};
				  var prefs = new _IG_Prefs();
				  var hudsonUrl = prefs.getString("hudsonUrl");
				  var view = prefs.getString("view");
				  var userName = prefs.getString("userName");
				  var password = prefs.getString("password");
				  params[gadgets.io.RequestParameters.POST_DATA] = gadgets.io.encodeValues({
					  hudsonUrl : hudsonUrl,
					  view : view,
					  userName : userName,
					  password : password
				  });
				  params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.POST;
				  params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;
				  var url = "__ATLASSIAN_BASE_URL__" + "/plugins/servlet/overviewservlet";
				  gadgets.io.makeRequest(url, response, params);
				};
				
				function response(obj) {
				  document.write(obj.text);
				  gadgets.window.adjustHeight();
				};
				
				makeDOMRequest();

            </script>
        ]]>
    </Content>
</Module>